(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.events={"submit .sandbox":"submitOperation","click .submit":"submitOperation","click .response_hider":"hideResponse","click .toggleOperation":"toggleOperationContent"},t.prototype.initialize=function(){},t.prototype.render=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;n=jQuery.inArray(this.model.httpMethod,this.model.supportedSubmitMethods())>=0,n||(this.model.isReadOnly=!0),$(this.el).html(Handlebars.templates.operation(this.model)),this.model.responseClassSignature&&this.model.responseClassSignature!=="string"?(s={sampleJSON:this.model.responseSampleJSON,isParam:!1,signature:this.model.responseClassSignature},i=new SignatureView({model:s,tagName:"div"}),$(".model-signature",$(this.el)).append(i.render().el)):$(".model-signature",$(this.el)).html(this.model.responseClass),e={isParam:!1,supportedContentTypes:this.model.supportedContentTypes},t=new ContentTypeView({model:e}),$(".content-type",$(this.el)).append(t.render().el),c=this.model.parameters;for(u=0,f=c.length;u<f;u++)r=c[u],this.addParameter(r);h=this.model.errorResponses;for(a=0,l=h.length;a<l;a++)o=h[a],this.addStatusCode(o);return this},t.prototype.addParameter=function(e){var t;return t=new ParameterView({model:e,tagName:"tr",readOnly:this.model.isReadOnly}),$(".operation-params",$(this.el)).append(t.render().el)},t.prototype.addStatusCode=function(e){var t;return t=new StatusCodeView({model:e,tagName:"tr"}),$(".operation-status",$(this.el)).append(t.render().el)},t.prototype.submitOperation=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x=this;e!=null&&e.preventDefault(),r=$(".sandbox",$(this.el)),n=!0,r.find("input.required").each(function(){var e=this;$(this).removeClass("error");if(jQuery.trim($(this).val())==="")return $(this).addClass("error"),$(this).wiggle({callback:function(){return $(e).focus()}}),n=!1});if(n){u={},w=r.serializeArray();for(d=0,g=w.length;d<g;d++)a=w[d],a.value!=null&&jQuery.trim(a.value).length>0&&(u[a.name]=a.value);o=$('input[type~="file"]').size!==0;if(o){t=new FormData,E=this.model.parameters;for(v=0,y=E.length;v<y;v++)l=E[v],l.paramType==="body"&&t.append(l.name,u[l.name]);$.each($('input[type~="file"]'),function(e,n){return t.append($(n).attr("name"),n.files[0])}),console.log(t)}t=null,S=this.model.parameters;for(m=0,b=S.length;m<b;m++)l=S[m],l.paramType==="body"&&(t=u[l.name]);log("bodyParam = "+t),i=null,s=this.model.supportHeaderParams()?(i=this.model.getHeaderParams(u),this.model.urlify(u,!1)):this.model.urlify(u,!0),log("submitting "+s),$(".request_url",$(this.el)).html("<pre>"+s+"</pre>"),p=$(".response_throbber",this.$el).get(0),this.spinner=(new Spinner).spin(p),f={type:this.model.httpMethod,url:s,headers:i,data:t,dataType:"json",processData:!1,error:function(e,t,n){return x.showErrorStatus(e,t,n)},success:function(e){return x.showResponse(e)},complete:function(e){return x.showCompleteStatus(e)}};if(f.type.toLowerCase()==="post"||f.type.toLowerCase()==="put"||f.type.toLowerCase()==="patch")f.contentType="application/json";return o&&(f.contentType=!1),c=$("td select[name=contentType]",$(this.el)).val(),c&&(f.contentType=c),h=$(".content > .content-type > div > select[name=contentType]",$(this.el)).val(),h&&(f.headers=f.headers!=null?f.headers:{},f.headers.accept=h),jQuery.ajax(f),!1}},t.prototype.hideResponse=function(e){return e!=null&&e.preventDefault(),$(".response",$(this.el)).slideUp(),$(".response_hider",$(this.el)).fadeOut()},t.prototype.showResponse=function(e){var t;return t=JSON.stringify(e,null,"	").replace(/\n/g,"<br>"),$(".response_body",$(this.el)).html(escape(t))},t.prototype.showErrorStatus=function(e){return this.showStatus(e)},t.prototype.showCompleteStatus=function(e){return this.showStatus(e)},t.prototype.formatXml=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;a=/(>)(<)(\/*)/g,l=/[ ]*(.*)[ ]+\n/g,t=/(<.+>)(.+\n)/g,e=e.replace(a,"$1\n$2$3").replace(l,"$1\n").replace(t,"$1\n$2"),u=0,n="",s=e.split("\n"),r=0,i="other",f={"single->single":0,"single->closing":-1,"single->opening":0,"single->other":0,"closing->single":0,"closing->closing":-1,"closing->opening":0,"closing->other":0,"opening->single":1,"opening->closing":0,"opening->opening":1,"opening->other":1,"other->single":0,"other->closing":-1,"other->opening":0,"other->other":0},c=function(e){var t,s,o,u,a,l,c;return l={single:Boolean(e.match(/<.+\/>/)),closing:Boolean(e.match(/<\/.+>/)),opening:Boolean(e.match(/<[^!?].*>/))},a=function(){var e;e=[];for(o in l)c=l[o],c&&e.push(o);return e}()[0],a=a===void 0?"other":a,t=i+"->"+a,i=a,u="",r+=f[t],u=function(){var e,t,n;n=[];for(s=e=0,t=r;0<=t?e<t:e>t;s=0<=t?++e:--e)n.push("  ");return n}().join(""),t==="opening->closing"?n=n.substr(0,n.length-1)+e+"\n":n+=u+e+"\n"};for(h=0,p=s.length;h<p;h++)o=s[h],c(o);return n},t.prototype.showStatus=function(e){var t,n,r;try{t=$("<code />").text(JSON.stringify(JSON.parse(e.responseText),null,2)),n=$('<pre class="json" />').append(t)}catch(i){t=$("<code />").text(this.formatXml(e.responseText)),n=$('<pre class="xml" />').append(t)}return r=n,$(".response_code",$(this.el)).html("<pre>"+e.status+"</pre>"),$(".response_body",$(this.el)).html(r),$(".response_headers",$(this.el)).html("<pre>"+e.getAllResponseHeaders()+"</pre>"),$(".response",$(this.el)).slideDown(),this.spinner.stop(),$(".response_hider",$(this.el)).show(),hljs.highlightBlock($(".response_body",$(this.el))[0])},t.prototype.toggleOperationContent=function(){var e;return e=$("#"+this.model.resourceName+"_"+this.model.nickname+"_"+this.model.httpMethod+"_"+this.model.number+"_content"),e.is(":visible")?Docs.collapseOperation(e):Docs.expandOperation(e)},t}(Backbone.View),window.OperationView=e}).call(this);